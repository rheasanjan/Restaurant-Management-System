BEGIN
DECLARE C_QUANTITY INTEGER DEFAULT 0;
DECLARE C_PRICE DECIMAL DEFAULT 0;
DECLARE C_FOODID INTEGER;
DECLARE C_TOTALPRICE DECIMAL DEFAULT 0;
DECLARE DONE INT DEFAULT FALSE;

DECLARE GET_TOTAL_PRICE CURSOR FOR
SELECT food_id,price,quantity FROM food,orders
WHERE food.foodid = orders.food_id
and total_price is NULL for UPDATE;
DECLARE CONTINUE HANDLER for NOT FOUND SET DONE=TRUE;

OPEN GET_TOTAL_PRICE;
MYLOOP:
LOOP
  FETCH GET_TOTAL_PRICE INTO C_FOODID,C_PRICE,C_QUANTITY;
  SET C_TOTALPRICE = C_QUANTITY * C_PRICE;
  IF DONE THEN LEAVE MYLOOP;
  END IF;
  UPDATE ORDERS SET total_price = C_TOTALPRICE WHERE food_id = C_FOODID;

  END LOOP;
  CLOSE GET_TOTAL_PRICE;
END
